<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Feliz Mesaversario ‚ù§Ô∏è ‚Äî Nuestra Peque√±a P√°gina</title>
  <meta name="description" content="Una sorpresita para nuestro 7 Mesaversario. Fotos De Nosotros, Una Carta De Mi Para Ti Y M√∫sica Para El Coraz√≥n." />
  <style>
    :root{
      --bg1:#fff0f6;
      --bg2:#fff7ed;
      --accent:#ff5370;
      --accent-2:#ff9aa2;
      --muted:#6b6b6b;
      --card:#ffffff;
      --glass: rgba(255,255,255,0.6);
      --shadow: 0 8px 24px rgba(0,0,0,0.12);
      --radius:16px;
      font-size:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "'Times New Roman', Times, serif";
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#222;
      -webkit-font-smoothing:antialiased;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .wrap{
      width:100%;
      max-width:1100px;
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,250,250,0.8));
      border-radius:20px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    header{
      padding:28px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
      border-bottom:1px solid rgba(0,0,0,0.05);
    }
    .title{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .title h1{
      margin:0;
      font-size:1.6rem;
      letter-spacing:0.2px;
    }
    .date{
      font-size:0.9rem;
      color:var(--muted);
    }
    .hearts{
      display:flex;
      gap:6px;
      align-items:center;
      filter: drop-shadow(0 4px 8px rgba(255,80,120,0.18));
    }
    .heart{
      width:30px;height:30px;border-radius:6px;
      display:inline-grid;place-items:center;
      background:linear-gradient(180deg,var(--accent),var(--accent-2));
      color:white;font-weight:700;
      animation:pop 2s infinite;
    }
    .heart:nth-child(2){animation-delay:0.3s}
    .heart:nth-child(3){animation-delay:0.6s}
    @keyframes pop{
      0%{transform:translateY(0) scale(1)}
      50%{transform:translateY(-8px) scale(1.08)}
      100%{transform:translateY(0) scale(1)}
    }

    main{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:20px;
      padding:24px;
      align-items:start;
    }
    /* Intro / hero */
    .hero{
      background: linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.5));
      padding:20px;
      border-radius:12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }
    .hero h2{margin:0 0 8px 0, }
    .hero p{margin:0 0 14px 0;color:var(--muted)}
    .controls{
      display:flex;gap:8px;flex-wrap:wrap;
    }
    .btn{
      background:var(--accent);
      color:white;border:none;padding:8px 10px;border-radius:10px;
      cursor:pointer;font-weight:600;box-shadow: 0 6px 14px rgba(0,0,0,0.08);
    }
    .btn.secondary{background:#fff;border:1px solid rgba(0,0,0,0.06);color:#333}

    /* Blog cards */
    .posts{
      margin-top:18px;
      display:grid;
      gap:12px;
    }
    .card{
      display:flex;gap:12px;padding:12px;background:var(--card);border-radius:12px;align-items:center;
      box-shadow: 0 4px 14px rgba(0,0,0,0.04);
      transition:transform .22s ease, box-shadow .22s ease;
    }
    .card:hover{transform:translateY(-6px);box-shadow: 0 10px 30px rgba(0,0,0,0.08)}
    .card img{width:110px;height:100px;object-fit:cover;border-radius:8px;flex-shrink:0}
    .card .meta{font-size:0.95rem}
    .card .meta small{display:block;color:var(--muted);font-size:0.85rem}

    /* Sidebar */
    aside{
      padding:12px;
      border-left:1px dashed rgba(0,0,0,0.03);
    }
    .gallery{
      display:grid;
      grid-template-columns: repeat(2,1fr);
      gap:8px;
      margin-bottom:12px;
    }
    .gallery img{
      width:100%;height:110px;object-fit:cover;border-radius:10px;
      transition:transform .28s cubic-bezier(.2,.9,.3,1), filter .22s;
      cursor:pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }
    .gallery img:hover{transform:scale(1.06) rotate(-1deg);filter:brightness(1.02)}
    .music-control{
      display:flex;align-items:center;gap:10px;padding:8px;margin-bottom:12px;
      background:var(--glass);border-radius:10px;
    }
    .messages{
      margin-top:12px;
      background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
      padding:10px;border-radius:10px;
    }
    .messages ul{list-style:none;padding:0;margin:0;max-height:160px;overflow:auto}
    .messages li{padding:8px;border-bottom:1px dashed rgba(0,0,0,0.04)}
    .messages li strong{display:block}

    /* Modals */
    .modal-overlay{
      position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;
      align-items:center;justify-content:center;z-index:1000;padding:20px;
    }
    .modal{
      background:linear-gradient(180deg,#fff,#fff9);padding:18px;border-radius:14px;max-width:900px;width:100%;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);position:relative;
    }
    .modal .close{
      position:absolute;right:12px;top:12px;border:none;background:transparent;font-size:18px;cursor:pointer;
    }

    /* Lightbox image */
    .lightbox-img{max-height:70vh;width:auto;max-width:100%;display:block;margin:0 auto;border-radius:10px}

    /* Letter */
    .letter{
      font-family: Georgia, "Times New Roman", serif;
      line-height:1.6;color:#333;
      max-height:60vh;overflow:auto;padding-right:6px;
      white-space:pre-wrap;font-size:1.05rem;
    }
    .typewriter-caret{
      display:inline-block;width:2px;background:#333;animation:blink .9s steps(1) infinite;margin-left:4px;
    }
    @keyframes blink{50%{opacity:0}}

    /* Footer */
    footer{padding:12px;text-align:center;color:var(--muted);border-top:1px solid rgba(0,0,0,0.03)}

    /* Responsive */
    @media (max-width:600px){
  body {
    padding: 10px;
  }
  .wrap {
    border-radius: 12px;
  }
  .hero h2 {
    font-size: 1.2rem;
    text-align: center;
  }
  .controls {
    flex-direction: column;
    align-items: center;
  }
  .btn {
    width: 100%;
    font-size: 0.95rem;
  }
  .gallery img {
    height: 90px;
  }
  #current-song {
    text-align: center;
    font-size: 0.9rem;
  }
}
  </style>
</head>
<body>
  <div class="wrap" role="application">
    <header>
      <div class="title">
        <div>
          <h1>Feliz Mesaversario ‚Äî Mi Coraz√≥n ‚ù§Ô∏è</h1>
          <div class="date">8 De Octubre ‚Äî ¬°Sorpresa!</div>
        </div>
      </div>
      <div class="hearts" aria-hidden="true">
        <div class="heart">üíó</div>
        <div class="heart">üíó</div>
        <div class="heart">üíó</div>
      </div>
    </header>

    <main>
      <section class="hero" aria-labelledby="hero-title">
        <h2 id="hero-title">UN LUGAR ESPECIAL DE NUESTROS MOMENTOS JUNTOS ‚ù§Ô∏è‚Äçüî•</h2>
        <p>Hola mi coraz√≥n, aqu√≠ guard√© fotos, una carta y un poco de m√∫sica para celebrar nuestros meses juntos. Puedes explorar la galer√≠a, leer la carta y dejar un mensaje ‚ù§Ô∏è</p>

        <div class="controls">
          <button class="btn" id="open-letter">Ver carta</button>
          <button class="btn" id="confetti-btn">¬°Celebrar!üéâ</button>
          <button class="btn secondary" id="download-letter">Descargar carta</button>
          <button class="btn secondary" id="toggle-music">Reproducir m√∫sica</button>
          <button class="btn secondary" id="next-music">‚è≠Ô∏è</button>
          <div id="current-song" class="small muted" style="margin-top:4px;">üé∂ No hay m√∫sica reproduci√©ndose...</div>
        </div>

        <div class="posts" aria-live="polite">
          <article class="card">
            <img src="assets/imagen_01.jpeg" alt="Una Foto casual de nosotros en el sena">
            <div class="meta">
              <strong>Una Foto casual de nosotros en el sena</strong>
              <small class="muted"> Somos t√∫ y yo juntos üíó</small>
            </div>
          </article>

          <article class="card">
            <img src="assets/imagen_02.jpeg" alt="Una Salida inolvidable">
            <div class="meta">
              <strong>Una Salida inolvidable</strong>
              <small class="muted">Ese Fue un d√≠a perfecto a tu lado ü•∞</small>
            </div>
          </article>

          <article class="card">
            <img src="assets/imagen_03.jpeg" alt="Risas">
            <div class="meta">
              <strong>Risas y m√°s risas</strong>
              <small class="muted">Nosotros este ultimo Viernes üåû</small>
            </div>
          </article>

          <article class="card">
            <img src="assets/imagen_10.jpeg" alt="Risas">
            <div class="meta">
              <strong>Mi cumple en el hospital</strong>
              <small class="muted"> ese dia fue de locos y te quedastes conmigo me encanto tenerte a mi lado üòΩüòª</small>
            </div>
          </article>

          <article class="card">
            <img src="assets/el_11.jpeg" alt="Risas">
            <div class="meta">
              <strong>Mi Pintor Favorito</strong>
              <small class="muted"> Gracias por la ayuda y por ser tan talentoso üé®</small>
            </div>
          </article>

          <article class="card">
            <img src="assets/imagen_08.jpeg" alt="Risas">
            <div class="meta">
              <strong> Por fin participamos!!</strong>
              <small class="muted"> Primera vez que participamos en algo de bienestar jajaja ü§£ü§£ü§£</small>
            </div>
          </article>
        </div>
      </section>

      <aside>
        <div class="music-control" aria-hidden="false">
          <div>
            <strong>üéµ M√∫sica de fondo</strong>
            <div class="small muted">Puedes pausar o reproducir cuando quieras</div>
          </div>
        </div>

        <div class="gallery" aria-label="Galer√≠a de fotos">
          <!-- Reemplaza las rutas por tus fotos en assets/ -->
          <img data-index="0" src="assets/el_0.jpeg" alt="foto 1">
          <img data-index="1" src="assets/yo_13.jpeg" alt="foto 2">
          <img data-index="2" src="assets/el_08.jpeg" alt="foto 3">
          <img data-index="3" src="assets/yo_14.jpeg" alt="foto 4">
          <img data-index="4" src="assets/yo_12.jpeg" alt="foto 5">
          <img data-index="6" src="assets/imagen_11.jpeg" alt="foto 6">
          <img data-index="7" src="assets/el_10.jpeg" alt="foto 7">
          <img data-index="8" src="assets/imagen_04.jpeg" alt="foto 8">
          <img data-index="9" src="assets/imagen_05.jpeg" alt="foto 9">
          <img data-index="10" src="assets/imagen_06.jpeg" alt="foto 10">
          <img data-index="11" src="assets/imagen_7.jpeg" alt="foto 11">
          <img data-index="13" src="assets/imagen_09.jpeg" alt="foto 12">
        </div>

        <div class="messages" aria-live="polite">
          <strong>Deja un mensaje üíå</strong>
          <form id="msg-form" style="margin-top:8px">
            <input id="msg-name" type="text" placeholder="Tu nombre" required style="width:100%;padding:8px;border-radius:8px;border:1px solid #eee;margin-bottom:8px">
            <textarea id="msg-text" placeholder="Escribe algo bonito..." required style="width:100%;padding:8px;border-radius:8px;border:1px solid #eee"></textarea>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn" type="submit">Enviar</button>
              <button type="button" class="btn secondary" id="clear-msgs">Borrar mensajes</button>
            </div>
          </form>

          <ul id="msgs-list" style="margin-top:10px"></ul>
        </div>
      </aside>
    </main>

    <footer>
      Hecho con mucho cari√±o para ti Mi Coraz√≥n Bello De <strong>T√∫ Amada Novia</strong> ‚ù§Ô∏è
    </footer>
  </div>

  <!-- Lightbox modal -->
  <div id="lightbox" class="modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <button class="close" id="lb-close" aria-label="Cerrar">‚úï</button>
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
        <button class="btn secondary" id="lb-prev">‚óÄ</button>
        <img id="lb-img" class="lightbox-img" src="" alt="Imagen ampliada">
        <button class="btn secondary" id="lb-next">‚ñ∂</button>
      </div>
      <div style="margin-top:8px;text-align:center;color:var(--muted)" id="lb-caption"></div>
    </div>
  </div>

  <!-- Letter modal -->
  <div id="letter" class="modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <button class="close" id="letter-close" aria-label="Cerrar carta">‚úï</button>
      <h3 style="margin-top:0">Mi carta para ti</h3>
      <div class="letter" id="letter-content" aria-live="polite"></div>
      <div style="margin-top:12px;text-align:right">
        <button class="btn secondary" id="pause-type">Pausa escritura</button>
      </div>
    </div>
  </div>

  <!-- Confetti canvas -->
  <canvas id="confetti-canvas" style="position:fixed;left:0;top:0;pointer-events:none;z-index:1500;display:none"></canvas>

  <!-- Background audio -->
  <!-- NOTA: Coloca tu canci√≥n en assets/song.mp3 o cambia el src -->
  <audio id="bg-music" src="assets/It's you  Ali Gatie  Letra en espa√±ol  ingl√©s.mp3" preload="auto"></audio>
  <audio id="bf-music" src="assets/Mal√∫  Ahora T√∫ [Letra].mp3" preload="auto"></audio>
  <audio id="bh-music" src="assets/Pensando en ti  L√öA  (Letra).mp3" preload="auto"></audio>
  <audio id="bi-music" src="assets/R√≠o Roma - Mi Persona Favorita (Lyric Video).mp3" preload="auto"></audio>

  <script>
    const letterText = `
    Holaaaa Mi Coraz√≥n Bello ‚ù§Ô∏è‚Äçüî•.
    
    El dia de hoy te quiero confesar que eres un ser tan maravilloso que a venido a iluminar mi vida sinceramente eres un regalo muy valioso.
    Eres una persona que con tus sonrisas, tus ocurrencias, tu manera de ser y sobre todo conmigo, me haces sentir super especial, me encanta que estes conmigo en mis caidas y me tienes paciencia con mis ataques de locura he ira; todos los momentos a tu lado son muy maravillosos, que me hacen ser una mejor persona solo por estar a t√∫ lado, le agradezco mucho a Dios por ponerte en mi vida y espero que sigas en ella para siempre.

    ‚ù£Ô∏èPorque contigo me siento viva y me dan ganas de vivirla contigo mi coraz√≥n‚ù£Ô∏è.

    `.trim();

    // Lista de im√°genes (se usan las que est√°n en la galer√≠a)
    const galleryImgs = Array.from(document.querySelectorAll('.gallery img')).map(img => ({
      src: img.src,
      alt: img.alt || ''
    }));

    // ---------- LIGHTBOX ----------
    const lightbox = document.getElementById('lightbox');
    const lbImg = document.getElementById('lb-img');
    const lbCaption = document.getElementById('lb-caption');
    let lbIndex = 0;

    function openLightbox(index){
      lbIndex = index;
      const item = galleryImgs[lbIndex];
      lbImg.src = item.src;
      lbImg.alt = item.alt;
      lbCaption.textContent = item.alt;
      lightbox.style.display = 'flex';
      lightbox.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
    }
    function closeLightbox(){
      lightbox.style.display = 'none';
      lightbox.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }
    function lbNext(){ openLightbox((lbIndex+1) % galleryImgs.length) }
    function lbPrev(){ openLightbox((lbIndex-1+galleryImgs.length) % galleryImgs.length) }

    document.querySelectorAll('.gallery img').forEach(img=>{
      img.addEventListener('click', e=>{
        const idx = Number(img.getAttribute('data-index')) || galleryImgs.findIndex(g=>g.src===img.src);
        openLightbox(idx);
      });
    });
    document.getElementById('lb-close').addEventListener('click', closeLightbox);
    document.getElementById('lb-next').addEventListener('click', lbNext);
    document.getElementById('lb-prev').addEventListener('click', lbPrev);
    lightbox.addEventListener('click', (e)=>{ if(e.target === lightbox) closeLightbox() });
    document.addEventListener('keydown', e=>{
      if(lightbox.style.display === 'flex'){
        if(e.key === 'Escape') closeLightbox();
        if(e.key === 'ArrowRight') lbNext();
        if(e.key === 'ArrowLeft') lbPrev();
      }
    });

    // ---------- LETTER (tipo m√°quina de escribir) ----------
    const letterModal = document.getElementById('letter');
    const letterContent = document.getElementById('letter-content');
    let charIndex = 0;
    let typing = false;
    let typeInterval = null;
    const typeSpeed = 24; // ms por caracter

    function startTyping(){
      letterContent.textContent = '';
      charIndex = 0;
      typing = true;
      typeInterval = setInterval(()=> {
        if(charIndex < letterText.length){
          // muestra hasta el car√°cter actual
          letterContent.textContent = letterText.slice(0,charIndex+1);
          // scroll autom√°tico
          letterContent.scrollTop = letterContent.scrollHeight;
          charIndex++;
        } else {
          stopTyping();
        }
      }, typeSpeed);
    }
    function stopTyping(){
      typing = false;
      clearInterval(typeInterval);
      typeInterval = null;
    }
    function openLetter(){
      letterModal.style.display = 'flex';
      letterModal.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      startTyping();
      runConfetti(3500);
    }
    function closeLetter(){
      letterModal.style.display = 'none';
      letterModal.setAttribute('aria-hidden','true');
      stopTyping();
      document.body.style.overflow = '';
    }

    document.getElementById('open-letter').addEventListener('click', openLetter);
    document.getElementById('letter-close').addEventListener('click', closeLetter);
    document.getElementById('pause-type').addEventListener('click', (ev) => {
      if (typing) {
        stopTyping();
        ev.target.textContent = 'Continuar escritura';
      } else {
        startTyping();
        ev.target.textContent = 'Pausa escritura';
      }
    });

    // Descarga de la carta como .txt
    document.getElementById('download-letter').addEventListener('click', ()=>{
      const blob = new Blob([letterText], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'carta_mi_coraz√≥n.txt';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    // ---------- M√öSICA ----------
// ---------- M√öSICA (multi canci√≥n) ----------
const songs = [
  { el: document.getElementById('bg-music'), name: "Ali Gatie ‚Äî It's You üíû" },
  { el: document.getElementById('bf-music'), name: "Mal√∫ ‚Äî Ahora T√∫ üåπ" },
  { el: document.getElementById('bh-music'), name: "L√öA ‚Äî Pensando en Ti üí≠" },
  { el: document.getElementById('bi-music'), name: "R√≠o Roma ‚Äî Mi Persona Favorita üíò" }
];

let currentSong = 0;
let musicPlaying = false;

const toggleMusicBtn = document.getElementById('toggle-music');
const nextMusicBtn = document.getElementById('next-music');
const currentSongLabel = document.getElementById('current-song');

function updateSongLabel() {
  if (!currentSongLabel) return; // protege si no existe el elemento en el HTML
  currentSongLabel.textContent = musicPlaying
    ? `üé∂ Est√° sonando: ${songs[currentSong].name}`
    : `üé∂ Pausado: ${songs[currentSong].name}`;
}

// Reproduce la canci√≥n actual (asegura pausar las dem√°s)
function playCurrentSong() {
  songs.forEach(s => { if (s && s.el) { s.el.pause(); s.el.currentTime = 0; } });
  const songEl = songs[currentSong] && songs[currentSong].el;
  if (!songEl) return Promise.reject('Elemento de audio no encontrado');
  return songEl.play().then(() => {
    musicPlaying = true;
    toggleMusicBtn.textContent = 'Pausar m√∫sica';
    updateSongLabel();
  }).catch(() => {
    musicPlaying = false;
    toggleMusicBtn.textContent = 'Reproducir m√∫sica';
    updateSongLabel();
  });
}

// Pausar canci√≥n actual
function pauseCurrentSong() {
  const s = songs[currentSong];
  if (s && s.el) s.el.pause();
  musicPlaying = false;
  toggleMusicBtn.textContent = 'Reproducir m√∫sica';
  updateSongLabel();
}

// Bot√≥n reproducir/pausar
if (toggleMusicBtn) {
  toggleMusicBtn.addEventListener('click', () => {
    if (!musicPlaying) playCurrentSong();
    else pauseCurrentSong();
  });
}

// Bot√≥n siguiente canci√≥n
if (nextMusicBtn) {
  nextMusicBtn.addEventListener('click', () => {
    const s = songs[currentSong];
    if (s && s.el) { s.el.pause(); s.el.currentTime = 0; }
    currentSong = (currentSong + 1) % songs.length;
    playCurrentSong();
  });
}

// Cuando termine una canci√≥n, pasa autom√°ticamente a la siguiente
songs.forEach((s, i) => {
  if (s && s.el) {
    s.el.addEventListener('ended', () => {
      currentSong = (i + 1) % songs.length;
      playCurrentSong();
    });
  }
});

// Actualiza etiqueta al cargar
window.addEventListener('DOMContentLoaded', () => {
  updateSongLabel();
});

// Intento de reproducir tras la primera interacci√≥n del usuario (para sortear bloqueo de autoplay)
['click', 'touchstart'].forEach(evName => {
  const handler = function once() {
    if (!musicPlaying) {
      playCurrentSong().catch(()=>{ /* silencio */ });
    }
    window.removeEventListener(evName, handler);
  };
  window.addEventListener(evName, handler, { passive: true });
});

    // ---------- CONFETTI (canvas) ----------
   // ---------- CONFETTI DE CORAZONES (canvas) ----------
const confCanvas = document.getElementById('confetti-canvas');
const confCtx = confCanvas.getContext('2d');
let confettiPieces = [];
let confettiRunning = false;

// Ajustar tama√±o del canvas al tama√±o de la ventana
function resizeCanvas(){
  confCanvas.width = window.innerWidth;
  confCanvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Crear corazones con posici√≥n y color aleatorio
function makeConfetti(){
  confettiPieces = [];
  const colors = ['#ff99c8', '#fcf6bd', '#a0ced9', '#b5ead7', '#ffb7b2', '#ff9fb9'];
  const count = 120;
  for(let i = 0; i < count; i++){
    confettiPieces.push({
      x: Math.random() * confCanvas.width,
      y: Math.random() * -confCanvas.height,
      size: 10 + Math.random() * 14,
      vx: -1.5 + Math.random() * 3,
      vy: 2 + Math.random() * 4,
      r: Math.random() * 360,
      cr: colors[Math.floor(Math.random() * colors.length)],
      rotationSpeed: -2 + Math.random() * 4
    });
  }
}

// Dibujar corazones
function drawHeart(ctx, x, y, size, color, rotation){
  ctx.save();
  ctx.translate(x, y);
  ctx.rotate(rotation);
  ctx.scale(size / 30, size / 30);
  ctx.beginPath();
  ctx.moveTo(0, 0);
  ctx.bezierCurveTo(0, -3, -5, -15, -15, -15);
  ctx.bezierCurveTo(-35, -15, -35, 10, -35, 10);
  ctx.bezierCurveTo(-35, 25, -10, 45, 0, 60);
  ctx.bezierCurveTo(10, 45, 35, 25, 35, 10);
  ctx.bezierCurveTo(35, 10, 35, -15, 15, -15);
  ctx.bezierCurveTo(5, -15, 0, -3, 0, 0);
  ctx.closePath();
  ctx.fillStyle = color;
  ctx.fill();
  ctx.restore();
}

// Funci√≥n principal del confetti
function runConfetti(duration = 4000){
  if(confettiRunning) return;
  confettiRunning = true;
  confCanvas.style.display = 'block';
  makeConfetti();
  const start = performance.now();

  function frame(now){
    confCtx.clearRect(0, 0, confCanvas.width, confCanvas.height);
    confettiPieces.forEach(p => {
      p.x += p.vx;
      p.y += p.vy;
      p.r += p.rotationSpeed * Math.PI / 180;
      drawHeart(confCtx, p.x, p.y, p.size, p.cr, p.r);
      // Reaparecer arriba cuando cae abajo
      if (p.y > confCanvas.height + 40) {
        p.y = -20;
        p.x = Math.random() * confCanvas.width;
      }
    });
    if(now - start < duration){
      requestAnimationFrame(frame);
    } else {
      confettiRunning = false;
      confCanvas.style.display = 'none';
      confCtx.clearRect(0, 0, confCanvas.width, confCanvas.height);
    }
  }
  requestAnimationFrame(frame);
}

// Bot√≥n de celebrar manual
document.getElementById('confetti-btn').addEventListener('click', () => runConfetti(4000));

    // ---------- MENSAJES (localStorage) ----------
    const form = document.getElementById('msg-form');
    const msgsList = document.getElementById('msgs-list');
    const clearBtn = document.getElementById('clear-msgs');

    function loadMsgs(){
      const raw = localStorage.getItem('mes_messages');
      let arr = [];
      try{ arr = raw ? JSON.parse(raw) : [] } catch(e){ arr = [] }
      msgsList.innerHTML = '';
      if(arr.length===0){ msgsList.innerHTML = '<li class="muted small">A√∫n no hay mensajes. S√© el primero ‚ù§Ô∏è</li>'; return }
      arr.slice().reverse().forEach(m=>{
        const li = document.createElement('li');
        li.innerHTML = '<strong>' + escapeHtml(m.name) + '</strong><div>' + escapeHtml(m.text) + '</div><small class="muted">' + new Date(m.t).toLocaleString() + '</small>';
        msgsList.appendChild(li);
      });
    }
    function saveMsg(name,text){
      const raw = localStorage.getItem('mes_messages');
      let arr = raw ? JSON.parse(raw) : [];
      arr.push({name,text,t:Date.now()});
      localStorage.setItem('mes_messages', JSON.stringify(arr));
      loadMsgs();
    }
    form.addEventListener('submit', e=>{
      e.preventDefault();
      const name = document.getElementById('msg-name').value.trim();
      const text = document.getElementById('msg-text').value.trim();
      if(!name || !text) return;
      saveMsg(name,text);
      form.reset();
    });
    clearBtn.addEventListener('click', ()=>{
      if(confirm('¬øBorrar todos los mensajes?')){ localStorage.removeItem('mes_messages'); loadMsgs() }
    });
    function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;') }

    // On load
    document.addEventListener('DOMContentLoaded', ()=>{
      loadMsgs();
    });

    // ---------- Accesibilidad y atajos ----------
    // Cerrar modales con ESC
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){
        if(letterModal.style.display === 'flex') closeLetter();
        if(lightbox.style.display === 'flex') closeLightbox();
      }
    });

    // Mensaje: intenta reproducir m√∫sica al interactuar (mejor experiencia)
    ['click','touchstart'].forEach(ev => {
      window.addEventListener(ev, function once(){
        if(!musicPlaying){
          audio.play().then(()=>{ musicPlaying = true; toggleMusicBtn.textContent = 'Pausar m√∫sica'}).catch(()=>{/* silencio */});
        }
        window.removeEventListener(ev, once);
      });
    }, {passive:true});

    // Peque√±o aviso: si no tienes archivos locales, las im√°genes usar√°n picsum como fallback
  </script>
</body>
</html>
